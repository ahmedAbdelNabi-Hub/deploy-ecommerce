import{a as y,c as ae,d as ie}from"./chunk-MDAXNIY5.js";import{$ as i,Ab as te,B as h,Ba as c,Bb as re,Ca as Q,D as N,Da as u,H as g,I as $,M as q,Ma as D,N as z,Na as F,Oa as H,Ra as f,Sa as x,Y as O,b as S,cb as J,eb as X,fa as m,ga as A,h as b,ha as o,hb as K,ib as Y,ja as n,jb as Z,ka as d,la as v,ma as R,na as U,oa as G,p as E,pa as M,pb as ee,qa as l,t as j,ua as T}from"./chunk-VKIXFHP4.js";import{a as k,b as B}from"./chunk-TSRGIXR5.js";var p=[];for(_=0;_<256;++_)p.push((_+256).toString(16).slice(1));var _;function ne(t,e=0){return(p[t[e+0]]+p[t[e+1]]+p[t[e+2]]+p[t[e+3]]+"-"+p[t[e+4]]+p[t[e+5]]+"-"+p[t[e+6]]+p[t[e+7]]+"-"+p[t[e+8]]+p[t[e+9]]+"-"+p[t[e+10]]+p[t[e+11]]+p[t[e+12]]+p[t[e+13]]+p[t[e+14]]+p[t[e+15]]).toLowerCase()}var P,se=new Uint8Array(16);function V(){if(!P&&(P=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!P))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return P(se)}var pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:pe};function de(t,e,a){if(W.randomUUID&&!e&&!t)return W.randomUUID();t=t||{};var r=t.random||(t.rng||V)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){a=a||0;for(var s=0;s<16;++s)e[a+s]=r[s];return e}return ne(r)}var L=de;var C=class{id=L();basketItems=[]};var w=class t{_http=g(ee);_basketSource=new S(null);numberOfItemInBasket=new S(0);numberOfItemInBasket$=this.numberOfItemInBasket.asObservable();basket$=this._basketSource.asObservable();getBasketByID(e){return this.getCurrentBasket()?this.basket$:this._http.get(`${y.Localhost+y.Basket}?id=${e}`).pipe(h(r=>{this._basketSource.next(r),this.numberOfItemInBasket.next(r.basketItems.length)}),E(r=>(console.error("Error fetching basket by ID:",r),b(null))))}setBasketInRedis(e){return this._http.put(`${y.Localhost+y.Basket}`,e).pipe(h(a=>{this._basketSource.next(a),this.numberOfItemInBasket.next(e.basketItems.length)}),E(a=>b(null)))}addItemInBasket(e,a=1){let r=this.mapProductToBasketItem(e,a),s=this.getCurrentBasket()??this.createBasket(),I=B(k({},s),{basketItems:this.addOrUpdateItem([...s.basketItems],r)});return this.areBasketsEqual(s,I)?(console.log("Basket not changed, skipping API request."),b(s)):this.setBasketInRedis(I)}updateBasketItemQuantity(e,a){let r=this.getCurrentBasket()??this.createBasket();if(e.quantity==a)return b(r);let s=B(k({},e),{quantity:a}),I=this.addOrUpdateItem(r.basketItems,s);return r.basketItems=I,this.setBasketInRedis(r)}deleteItemFromBasket(e){let a=this.getCurrentBasket()??this.createBasket(),r=a.basketItems.filter(I=>I.productId!==e.productId),s=B(k({},a),{basketItems:r});return this.setBasketInRedis(s)}areBasketsEqual(e,a){return JSON.stringify(e)===JSON.stringify(a)}addOrUpdateItem(e,a){let r=e.find(s=>s.productId==a.productId);return r?r.quantity=a.quantity:e.push(a),e}getCurrentBasket(){return this._basketSource.value}createBasket(){let e=new C;return localStorage.setItem("basket_id",e.id),e}mapProductToBasketItem(e,a=1){let r=e.offerPrice&&e.offerPrice>0?e.offerPrice:e.price;return{productId:e.id,productName:e.name,description:e.description,brand:e.brand,quantity:a,price:e.price,offerPrice:e.offerPrice??null,imageUrl:e.imageUrl,unitOfStock:e.stockQuantity,subTotal:r*a,deliveryTimeInDays:e.deliveryTimeInDays}}static \u0275fac=function(a){return new(a||t)};static \u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"})};var le=t=>({"py-2 md:py-1":t}),me=(t,e,a)=>({"h-[100px]":t,"h-[130px]":e,"h-[150px] xs:h-[230px] max-h-[200px]":a}),ue=t=>({sku:t}),fe=(t,e)=>["/product",t,e],xe=t=>({"text-[14px] mb-3":t}),Ie=(t,e)=>({"flex-col":t,"flex-row":e});function ge(t,e){t&1&&v(0,"i",17)}function ve(t,e){if(t&1&&(n(0,"div",18),v(1,"i",19),n(2,"span"),c(3),d()()),t&2){let a=l();i(3),u("Delivery in ",a.productData.deliveryTimeInDays," days")}}function be(t,e){if(t&1&&(n(0,"div",20)(1,"p",21),c(2),f(3,"number"),n(4,"span",22),c(5,"EGP"),d()(),n(6,"p",23),c(7),f(8,"number"),n(9,"span",22),c(10,"EGP"),d()()()),t&2){let a=l();o("ngClass",F(7,Ie,a.Recently,!a.Recently)),i(2),u(" ",x(3,3,a.getProductPrice())," "),i(5),u(" ",x(8,5,a.productData.price)," ")}}function he(t,e){if(t&1&&(n(0,"p",24),c(1),f(2,"number"),n(3,"span",22),c(4,"EGP"),d()()),t&2){let a=l();i(),u(" ",x(2,1,a.productData.price)," ")}}function ye(t,e){if(t&1&&(n(0,"p",28),c(1),f(2,"date"),d()),t&2){let a=l(2);i(),u(" End Of: ",x(2,1,a.productData.offerEndDate)," ")}}function ke(t,e){if(t&1&&(n(0,"p",29),c(1),f(2,"number"),d()),t&2){let a=l(2);i(),u(" Save ",x(2,1,a.productData.discount)," EGP ")}}function Be(t,e){if(t&1&&(n(0,"div",25),m(1,ye,3,3,"p",26)(2,ke,3,3,"p",27),d()),t&2){let a=l();i(),o("ngIf",a.productData.offerPrice&&a.productData.offerPrice>0),i(),o("ngIf",a.isOfferValid())}}function De(t,e){t&1&&(R(0),n(1,"div",33),v(2,"span",34),d(),U())}function _e(t,e){t&1&&(R(0),v(1,"i",35),n(2,"span"),c(3,"Add to Cart"),d(),U())}function Pe(t,e){if(t&1){let a=G();n(0,"div",30)(1,"button",31),M("click",function(){q(a);let s=l();return z(s.addToBasket(s.productData))}),m(2,De,3,0,"ng-container",32),f(3,"async"),m(4,_e,4,0,"ng-container",32),f(5,"async"),d()()}if(t&2){let a=l();i(2),o("ngIf",x(3,2,a.perform.isLoading$)),i(2),o("ngIf",!x(5,4,a.perform.isLoading$))}}var oe=class t{productData;Row=!1;EnableForProductsPage=!1;router=g(te);_basketService=g(w);perform=new ie;messageService=g(ae);Recently=!1;gift=!1;navigateToProduct(e){this.router.navigate(["/product",e.categoryName,e.nameEn],{state:{id:e.id}})}addToBasket(e){let a=this._basketService.addItemInBasket(e);this.perform.load(a.pipe(j(1e3),h(r=>{r&&this.messageService.showSuccess("Item added! Continue shopping or proceed to checkout")})))}isOfferValid(){if(!this.productData?.offerStartDate||!this.productData?.offerEndDate)return!1;let e=new Date,a=new Date(this.productData.offerStartDate),r=new Date(this.productData.offerEndDate);return a<r&&e<r}getProductPrice(){return this.isOfferValid()&&this.productData.offerPrice!==null?this.productData.offerPrice:this.productData.price}ngOnDestroy(){this.perform.unsubscribe()}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=$({type:t,selectors:[["app-product-card-with-discound"]],inputs:{productData:"productData",Row:[0,"showWithRow","Row"],EnableForProductsPage:"EnableForProductsPage",Recently:"Recently",gift:"gift"},decls:20,vars:35,consts:[["role","article",1,"relative","pt-5","pb-2","h-auto","flex","flex-col","bg-white","border","border-[#eee]",3,"ariaLabel"],["class","bx bxs-offer absolute top-3 left-4 text-2xl text-gray-600",4,"ngIf"],[1,"flex","justify-center",3,"ngClass"],[3,"ngClass"],["type","image/webp",3,"srcset"],["width","400","height","300","loading","lazy","decoding","async","fetchpriority","low",1,"object-contain","max-h-52","md:max-h-52","pt-4","hover:scale-[1.1]","transition-transform","cursor-pointer",2,"height","100%",3,"src","alt"],[1,"mb-2","text-center"],[1,"text-xs","font-medium","uppercase","text-gray-700","px-2","py-1","rounded-full"],[1,"py-1","px-4","md:px-5","md:py-1","overflow-hidden"],["class","text-xs text-gray-600 mb-2 flex items-center gap-1",4,"ngIf"],[1,"hover:underline","transition-all",3,"queryParams","routerLink"],[1,"line-clamp-2","mt-2","text-gray-600","text-[13px]","h-[40px]",3,"ngClass","id"],[1,"py-2","mb-4","h-14"],["class","flex",3,"ngClass",4,"ngIf"],["class","text-[18px] xs:text-[18px] mx-1",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],["class","w-full px-3",4,"ngIf"],[1,"bx","bxs-offer","absolute","top-3","left-4","text-2xl","text-gray-600"],[1,"text-xs","text-gray-600","mb-2","flex","items-center","gap-1"],[1,"bx","bx-time"],[1,"flex",3,"ngClass"],[1,"text-[17px]","xs:text-[18px]","font-semibold"],[1,"text-[10px]"],[1,"text-[14px]","mx-2","xs:text-[14px]","line-through","text-gray-500"],[1,"text-[18px]","xs:text-[18px]","mx-1"],[1,"flex","items-center","space-x-2"],["class","text-[12px]",4,"ngIf"],["class","text-green-400 text-[11px] font-bold capitalize",4,"ngIf"],[1,"text-[12px]"],[1,"text-green-400","text-[11px]","font-bold","capitalize"],[1,"w-full","px-3"],[1,"w-full","flex","items-center","justify-center","gap-2","py-2","px-4","mt-2","rounded-full","border","border-gray-200","bg-white","hover:bg-black","hover:text-white","hover:shadow-sm","transition-all","duration-300","ease-in-out","text-sm","font-medium",3,"click"],[4,"ngIf"],[1,"flex","justify-center"],[1,"loader","w-4","h-4"],[1,"bx","bxs-cart-add","text-lg"]],template:function(a,r){a&1&&(n(0,"div",0),m(1,ge,1,0,"i",1),n(2,"div",2)(3,"div",3)(4,"picture"),v(5,"source",4)(6,"img",5),d()()(),n(7,"div",6)(8,"span",7),c(9),d()(),n(10,"div",8),m(11,ve,4,1,"div",9),n(12,"a",10)(13,"h2",11),c(14),d()(),n(15,"div",12),m(16,be,11,10,"div",13)(17,he,5,3,"p",14)(18,Be,3,2,"div",15),d()(),m(19,Pe,6,6,"div",16),d()),a&2&&(o("ariaLabel","product-title-"+r.productData.sku),i(),o("ngIf",r.isOfferValid()&&!r.Recently&&!r.EnableForProductsPage),i(),o("ngClass",D(22,le,r.EnableForProductsPage)),i(),o("ngClass",H(24,me,r.Recently,!r.Recently,r.EnableForProductsPage)),i(2),o("srcset",r.productData.imageUrl+`?w=300&format=webp 300w, 
                                    `+r.productData.imageUrl+`?w=600&format=webp 600w, 
                                    `+r.productData.imageUrl+"?w=1000&format=webp 1000w"),i(),T("alt","",r.productData.name," - Image"),o("src",r.productData.imageUrl+"?w=300&format=webp",O),i(3),Q(r.productData.brand),i(2),o("ngIf",!r.Recently),i(),o("queryParams",D(28,ue,r.productData.id))("routerLink",F(30,fe,r.productData.categoryName,r.productData.name)),A("href","/product/"+r.productData.sku,O)("aria-label","View product "+r.productData.name),i(),T("id","product-title-",r.productData.sku,""),o("ngClass",D(33,xe,r.EnableForProductsPage)),i(),u(" ",r.productData.description," "),i(2),o("ngIf",r.isOfferValid()),i(),o("ngIf",!r.isOfferValid()),i(),o("ngIf",!r.Recently&&r.isOfferValid()),i(),o("ngIf",!r.EnableForProductsPage&&!r.Recently))},dependencies:[J,X,re,K,Z,Y]})};export{w as a,oe as b};
